@using BugBusiness.Interface.BugSecurity.DTO
@model List<List<BugWeb.Models.TreatmentViewModel>>
@{
    ViewBag.Title = "Treatments";
    UserDTO user = (UserDTO)Session["UserInfo"];
    int farmNum = -1;
    int blockNum = -1;
}

<h2>Treatments</h2>

<div>
    <br />
    @foreach (var item in user.Farms)
    {
        farmNum += 1;
        blockNum = -1;
        <div class="row">
            <div class="col-sm-8" style="font-size: 20pt;text-align:center;margin-bottom:5px">@Html.DisplayFor(modelItem => item.FarmName)</div>
        </div>
        <div class="col-sm-11 farm-table">
            <div class="row farm-table-head">
                <div style="font-size: 12pt;font-weight:bold;text-align:center" class="col-sm-3">Block Name</div>
                <div style="font-size: 12pt;font-weight:bold;text-align:center" class="col-sm-3">Pests Per Tree</div>
                <div style="font-size: 12pt;font-weight:bold;text-align:center" class="col-sm-2">Last Treatment</div>
            </div>
            @foreach (var block in item.Blocks)
            {
                <!--Add Treatment-->
                <div id="@Html.Raw("add" + block.BlockID)" class="modal fade" role="dialog">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Add Treatment</h4>
                            </div>
                            <div class="modal-body">
                                <p>Please enter the treatment of the date and any comments about the treatment</p>
                                <form id="form_@block.BlockID" method="POST" action="./AddTreatment" style="align-content:center">
                                    <input type="number" value="@block.BlockID" name="BlockID" hidden />
                                    <label for="TreatmentDate">Date</label>
                                    <input type="date" value="@DateTime.Today.ToString("yyyy-MM-dd")" name="TreatmentDate" id="TreatmentDate"/><br/>
                                    <div class="input-group">
                                        <span class="input-group-addon">
                                            <label for="TreatmentComments">Comments</label>
                                            <textarea rows="5" cols="30" id="TreatmentComments" name="TreatmentComments" placeholder="Enter comments here"></textarea>
                                        </span>
                                    </div>
                                    <input type="Submit" value="Add" />
                                </form>
                                <br />
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                blockNum += 1;
                <div class="row">
                    <div class="col-sm-3">@Html.DisplayFor(modelItem => block.BlockName)</div>
                    <div class="col-sm-3">@Html.DisplayFor(modelItem=>Model[farmNum][blockNum].PestsPerTree)</div>
                    <div class="col-sm-2">@Html.DisplayFor(modelItem => Model[farmNum][blockNum].LastTreatment)</div>
                    <div class="col-sm-3">
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#@Html.Raw("add" + block.BlockID)">Add Treatment</button>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#@Html.Raw("history" + block.BlockID)">History</button>
                    </div>
                </div>
                <br />
            }
        </div>
    }
</div>

